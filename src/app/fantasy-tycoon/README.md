# Fantasy Tycoon Event System

## Overview
This module implements an agentic event system for the Fantasy Tycoon game, using LLM-powered event generation and attribute-driven outcome resolution.

### Main Concepts
- **Event Generation:** Uses an LLM to generate structured events with multiple options.
- **Event Resolution:** Resolves user choices based on option probabilities and character attributes.
- **Attribute Management:** Character stats (strength, intelligence, luck, etc.) affect outcomes.

## Key Types
- `FantasyCharacter`: Character with attributes and stats.
- `LLMGeneratedEvent`/`FantasyStoryEvent`: Event objects generated by the LLM or system.
- `FantasyDecisionOption`: Options for decisions, including probability and effects.

## Event Flow
1. **Move Forward**: Calls the LLM to generate events, or produces generic messages.
2. **Display**: UI shows events and options for the player to choose.
3. **Resolve**: The system calculates outcome probabilities using attributes and applies effects.

## Testing
Unit tests are in `__tests__/` for:
- Event generation
- Decision resolution
- Attribute management

## Extending
- Add new attributes to `FantasyCharacter`.
- Update prompt in `llmEventGenerator.ts` to teach the LLM about new schema fields.
- Add new tests as you add logic.

## File Structure
- `lib/llmEventGenerator.ts`: LLM event generation logic
- `api/v1/fantasy-tycoon/move-forward/route.ts`: Move forward API
- `api/v1/fantasy-tycoon/resolve-decision/route.ts`: Decision resolution API
- `models/`: Types and interfaces
- `__tests__/`: Unit tests

---

## Inventory & Rewards

The Fantasy Tycoon game features a persistent inventory system and item rewards from events:

- **Inventory**: Each player has an inventory of `Item` objects (`id`, `name`, `description`, `icon`, `quantity`).
- **Store Actions**: Use `addItem`, `removeItem`, and `updateQuantity` to manage inventory.
- **Persistence**: Inventory is saved to localStorage and restored on reload.
- **UI**: The `InventoryPanel` shows all items, lets you use or discard them, and updates in real time.
- **Event Rewards**: Events can grant items as rewards, which are added to inventory and shown in the StoryFeed.
- **Edge Cases**: Adding an item you already have merges quantities. Setting quantity to 0 or less removes the item.

See `lib/inventory.ts` and `components/InventoryPanel.tsx` for implementation details.

For details, see code comments and the docs folder.
